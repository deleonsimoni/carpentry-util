<!-- Public Header -->
<app-public-header></app-public-header>

<!-- Split background -->
<div class="split-background"></div>

<!-- Page content -->
<div class="container pb-5" style="padding-top: 12rem;">
  <div class="row justify-content-center">
    <div class="col-lg-5 col-md-7">
      <div class="card bg-secondary shadow border-0">
        <div class="card-body px-lg-5 py-lg-5">
          <div>
            <img class="mb-2" src="assets/img/brand/carpentry-sign-in.png" />
          </div>

          <!-- Invalid token -->
          <div *ngIf="invalidToken" class="text-center">
            <div class="mb-4">
              <i class="ni ni-fat-remove text-danger" style="font-size: 2rem;"></i>
            </div>
            <p class="text-muted">
              Invalid or missing reset token. Please request a new password reset link.
            </p>
            <a [routerLink]="['/forgot-password']" class="btn btn-primary mt-2">Request new link</a>
          </div>

          <!-- Reset form -->
          <div *ngIf="!invalidToken && !success">
            <div class="text-center text-muted mb-4">
              <small>Enter your new password below.</small>
            </div>
            <form [formGroup]="resetForm" role="form">
              <div class="form-group mb-3">
                <div class="input-group input-group-alternative">
                  <div class="input-group-prepend">
                    <span class="input-group-text"><i class="ni ni-lock-circle-open"></i></span>
                  </div>
                  <input class="form-control" formControlName="password" placeholder="New password" type="password">
                </div>
                <small *ngIf="resetForm.get('password')?.touched && resetForm.get('password')?.hasError('minlength')" class="text-danger">
                  Password must be at least 6 characters
                </small>
              </div>
              <div class="form-group">
                <div class="input-group input-group-alternative">
                  <div class="input-group-prepend">
                    <span class="input-group-text"><i class="ni ni-lock-circle-open"></i></span>
                  </div>
                  <input class="form-control" formControlName="confirmPassword" placeholder="Confirm new password" type="password">
                </div>
                <small *ngIf="passwordMismatch" class="text-danger">
                  Passwords do not match
                </small>
              </div>
              <div class="text-center">
                <button type="button" (click)="submit()" [disabled]="passwordMismatch" class="btn btn-primary my-4">Reset password</button>
              </div>
            </form>
          </div>

          <!-- Success message -->
          <div *ngIf="success" class="text-center">
            <div class="mb-4">
              <i class="ni ni-check-bold text-success" style="font-size: 2rem;"></i>
            </div>
            <p class="text-muted">
              Your password has been reset successfully. You can now sign in with your new password.
            </p>
            <button type="button" (click)="goToLogin()" class="btn btn-primary mt-2">Sign in</button>
          </div>
        </div>
      </div>
      <div class="row mt-3">
        <div class="col-6">
          <a [routerLink]="['/login']" class="text-light"><small>Back to Sign in</small></a>
        </div>
        <div class="col-6 text-right">
          <a [routerLink]="['/register']" class="text-light"><small>Create new account</small></a>
        </div>
      </div>
    </div>
  </div>
</div>
