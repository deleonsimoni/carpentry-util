<div class="header bg-gradient-danger pb-8 pt-5 pt-md-8">
  <!-- Header container -->
  <div class="container-fluid d-flex align-items-center">
    <div class="row">
      <div class="col-lg-12 col-md-10">
        <!-- Navigation breadcrumb -->
        <nav aria-label="breadcrumb" class="mb-3">
          <ol class="breadcrumb bg-transparent p-0 mb-2">
            <li class="breadcrumb-item">
              <a routerLink="/takeoff" class="text-white">
                <i class="fas fa-arrow-left mr-2"></i>Back to Home
              </a>
            </li>
            <li class="breadcrumb-item active text-white-50" aria-current="page">
              Takeoff
            </li>
          </ol>
        </nav>

        <h1 class="display-2 text-white">Create your takeoff</h1>
        <p class="text-white mt-0 mb-5">
          This is your takeoff page. Here link you and
        </p>
      </div>
    </div>
  </div>
</div>
<div class="container-fluid mt--9">
  <div class="row">
    <div class="col-xl-12 order-xl-1">
      <div class="card bg-secondary shadow">
        <div class="card-header bg-white border-0">
          <div class="row align-items-center">
            <div class="col-8">
              <h3 class="mb-0">Takeoff</h3>
              <!-- Current Status Display -->
              <div *ngIf="orderStatus" class="mt-2">
                <span class="badge" [ngClass]="'badge-' + (statusService.getStatusColor(orderStatus) || 'secondary')">
                  <i [class]="'fas ' + (statusService.getStatusIcon(orderStatus) || 'fa-circle') + ' mr-1'"></i>
                  {{ statusService.getStatusLabel(orderStatus) }}
                </span>

                <!-- Company Status Control Dropdown -->
                <div class="mt-2" *ngIf="idOrder && isManager && canAdvanceStatus()">
                  <div ngbDropdown placement="bottom-left">
                    <button
                      class="btn btn-sm btn-outline-primary"
                      ngbDropdownToggle
                      [disabled]="isAdvancingStatus">
                      <i class="fas fa-exchange-alt mr-1"></i>
                      <span *ngIf="!isAdvancingStatus">Change Status</span>
                      <span *ngIf="isAdvancingStatus">
                        <i class="fas fa-spinner fa-spin mr-1"></i>
                        Updating...
                      </span>
                    </button>

                    <div ngbDropdownMenu class="dropdown-menu-arrow">
                      <h6 class="dropdown-header">Change Status To:</h6>
                      <button
                        *ngFor="let status of getAllStatuses()"
                        type="button"
                        class="dropdown-item d-flex align-items-center"
                        [ngClass]="{'active': status.id === orderStatus, 'disabled': status.id === orderStatus}"
                        (click)="advanceToSpecificStatus(status.id)"
                        [disabled]="status.id === orderStatus">
                        <i [class]="'fas ' + status.icon + ' mr-2 text-' + status.color"></i>
                        <div>
                          <div class="fw-semibold">
                            {{status.label}}
                            <span *ngIf="status.id === orderStatus" class="badge badge-sm badge-secondary ml-1">Current</span>
                          </div>
                          <small class="text-muted">{{status.description}}</small>
                        </div>
                      </button>
                    </div>
                  </div>
                </div>
              </div>
              <!-- Read-only indicator for completed takeoffs -->
              <div *ngIf="shouldShowReadOnlyIndicator()" class="mt-2">
                <span class="badge badge-success">
                  <i class="fas fa-lock mr-1"></i>
                  Completed - Read Only
                </span>
              </div>
            </div>
            <div class="col-4 text-right">

              <a
                *ngIf="shouldShowRecallEmailButton()"
                href="#!"
                class="btn btn-sm btn-primary"
              >
                Recall email to carpenter
              </a>
              <!-- Show status for read-only mode -->
              <div *ngIf="shouldShowCompletionStatus()" class="text-muted mt-2">
                <small>
                  <i class="fas fa-check-circle text-success mr-1"></i>
                  Takeoff completed
                </small>
              </div>
            </div>
          </div>
        </div>
        <div class="card-body">
          <form [formGroup]="orderForm">
            <div class="d-flex align-items-center mb-4">
              <h6 class="heading-small text-muted mb-0 mr-3">Carpenter Assignment</h6>
              <span class="badge badge-pill badge-primary mr-2">
                <i class="fas fa-ruler mr-1"></i>
                Measurement
              </span>
              <span class="badge badge-pill badge-info">
                <i class="fas fa-cut mr-1"></i>
                Trim Work
              </span>
            </div>
            <div class="pl-lg-4">
              <div class="row">
                <div class="col-lg-6">
                  <div class="card border-primary mb-3">
                    <div class="card-header bg-primary text-white py-2">
                      <div class="d-flex align-items-center">
                        <i class="fas fa-ruler mr-2"></i>
                        <strong>Measurement Carpenter</strong>
                        <span class="badge badge-light badge-sm ml-2">Required</span>
                      </div>
                    </div>
                    <div class="card-body">
                      <div *ngIf="(shouldShowCarpenterSearch() || canEditCarpenterAssignments()) && !isCarpentryFound && !nameCarpentry">
                        <app-carpenter-autocomplete
                          label=""
                          placeholder="Search measurement carpenter by name or email..."
                          (carpenterSelected)="onCarpenterSelected($event)"
                          (carpenterCleared)="onCarpenterCleared()"
                          [disabled]="shouldDisableFormField()">
                        </app-carpenter-autocomplete>
                      </div>

                      <div *ngIf="isCarpentryFound || nameCarpentry" class="mt-3">
                        <div class="d-flex align-items-center justify-content-between">
                          <div>
                            <small class="text-muted d-block">Assigned Carpenter:</small>
                            <strong class="text-primary">
                              <i class="fas fa-user mr-1"></i>
                              {{ nameCarpentry }}
                            </strong>
                            <br>
                            <small class="text-muted">{{ emailCarpentry }}</small>
                          </div>
                          <div *ngIf="canEditCarpenterAssignments()" class="ml-2">
                            <button
                              type="button"
                              class="btn btn-sm btn-outline-danger"
                              (click)="onCarpenterCleared()"
                              title="Remove carpenter">
                              <i class="fas fa-times"></i>
                            </button>
                          </div>
                        </div>
                      </div>
                    </div>
                  </div>
                </div>

                <div class="col-lg-6">
                  <div class="card border-info mb-3">
                    <div class="card-header bg-info text-white py-2">
                      <div class="d-flex align-items-center">
                        <i class="fas fa-cut mr-2"></i>
                        <strong>Trim Carpenter</strong>
                        <span class="badge badge-light badge-sm ml-2">Optional</span>
                      </div>
                    </div>
                    <div class="card-body">
                      <div *ngIf="(shouldShowCarpenterSearch() || canEditCarpenterAssignments()) && !isTrimCarpentryFound && !nameTrimCarpentry">
                        <app-carpenter-autocomplete
                          label=""
                          placeholder="Search trim carpenter by name or email..."
                          (carpenterSelected)="onTrimCarpenterSelected($event)"
                          (carpenterCleared)="onTrimCarpenterCleared()"
                          [disabled]="shouldDisableFormField()">
                        </app-carpenter-autocomplete>
                      </div>

                      <div *ngIf="isTrimCarpentryFound || nameTrimCarpentry" class="mt-3">
                        <div class="d-flex align-items-center justify-content-between">
                          <div>
                            <small class="text-muted d-block">Assigned Carpenter:</small>
                            <strong class="text-info">
                              <i class="fas fa-user mr-1"></i>
                              {{ nameTrimCarpentry }}
                            </strong>
                            <br>
                            <small class="text-muted">{{ emailTrimCarpentry }}</small>
                          </div>
                          <div *ngIf="canEditCarpenterAssignments()" class="ml-2">
                            <button
                              type="button"
                              class="btn btn-sm btn-outline-danger"
                              (click)="onTrimCarpenterCleared()"
                              title="Remove trim carpenter">
                              <i class="fas fa-times"></i>
                            </button>
                          </div>
                        </div>
                      </div>

                      <div *ngIf="!isTrimCarpentryFound && !nameTrimCarpentry && idOrder" class="mt-3">
                        <div class="text-center text-muted">
                          <i class="fas fa-plus-circle fa-2x mb-2"></i>
                          <p class="mb-0 small">No trim carpenter assigned</p>
                          <p class="mb-0 small" *ngIf="canEditCarpenterAssignments()">You can add one using the search above</p>
                        </div>
                      </div>
                    </div>
                  </div>
                </div>
              </div>
            </div>
            <h6
              *ngIf="isCarpentryFound || idOrder"
              class="heading-small text mb-4"
            >
              Customer information
            </h6>
            <div
              *ngIf="isCarpentryFound || idOrder"
              [@fadeAnimation]="isCarpentryFound || idOrder ? 'in' : 'out'"
              class="pl-lg-4"
            >
              <div class="row">
                <div class="col-lg-12">
                  <div class="form-group">
                    <label class="form-control-label" for="input-username"
                      >Builder Name</label
                    >
                    <input
                      type="text"
                      id="input-username"
                      class="form-control form-control-alternative"
                      placeholder="Customer Name"
                      formControlName="custumerName"
                    />
                  </div>
                </div>
              </div>
              <div class="row">
                <div class="col-lg-6">
                  <div class="form-group">
                    <label class="form-control-label" for="input-email"
                      >Foremen</label
                    >
                    <input
                      type="email"
                      id="input-email"
                      class="form-control form-control-alternative"
                      placeholder="Foremen"
                      formControlName="foremen"
                    />
                  </div>
                </div>
                <div class="col-lg-6">
                  <div class="form-group">
                    <label class="form-control-label" for="input-first-name"
                      >Extras Checked</label
                    >
                    <input
                      type="text"
                      id="input-first-name"
                      class="form-control form-control-alternative"
                      placeholder="Extras Checked"
                      formControlName="extrasChecked"
                    />
                  </div>
                </div>
                <div class="col-lg-6">
                  <div class="form-group">
                    <label class="form-control-label" for="input-last-name"
                      >Carp. Invoice #</label
                    >
                    <input
                      type="text"
                      id="input-last-name"
                      class="form-control form-control-alternative"
                      placeholder="Carp. Invoice #"
                      formControlName="carpInvoice"
                    />
                  </div>
                </div>
              </div>
              <div class="row">
                <div class="col-lg-3">
                  <div class="form-group">
                    <label class="form-control-label" for="input-last-name"
                      >Job Site</label
                    ><!--SHIP TO OLD-->
                    <input
                      type="text"
                      id="input-last-name"
                      class="form-control form-control-alternative"
                      placeholder="Job Site"
                      formControlName="shipTo"
                    />
                  </div>
                </div>

                <div class="col-lg-3">
                  <div class="form-group">
                    <label class="form-control-label" for="input-last-name"
                      >Lot.</label
                    >
                    <input
                      type="text"
                      id="input-last-name"
                      class="form-control form-control-alternative"
                      placeholder="Lot"
                      formControlName="lot"
                    />
                  </div>
                </div>

                <div class="col-lg-3">
                  <div class="form-group">
                    <label class="form-control-label" for="input-last-name"
                      >Type</label
                    >
                    <input
                      type="text"
                      id="input-last-name"
                      class="form-control form-control-alternative"
                      placeholder="Type"
                      formControlName="type"
                    />
                  </div>
                </div>

                <div class="col-lg-3">
                  <div class="form-group">
                    <label class="form-control-label" for="input-last-name"
                      >Elev.</label
                    >
                    <input
                      type="text"
                      id="input-last-name"
                      class="form-control form-control-alternative"
                      placeholder="Elev"
                      formControlName="elev"
                    />
                  </div>
                </div>
              </div>

              <div class="row">
                <div class="col-lg-6">
                  <div class="form-group">
                    <label class="form-control-label" for="input-last-name"
                      >SQ Footage</label
                    >
                    <input
                      type="text"
                      id="input-last-name"
                      class="form-control form-control-alternative"
                      placeholder="SQ Footage"
                      formControlName="sqFootage"
                    />
                  </div>
                </div>

                <div class="col-lg-6">
                  <div class="form-group">
                    <label class="form-control-label" for="input-last-name"
                      >Street Name</label
                    >
                    <input
                      type="text"
                      id="input-last-name"
                      class="form-control form-control-alternative"
                      placeholder="Street Name"
                      formControlName="streetName"
                    />
                  </div>
                </div>
              </div>

              <div class="row">
                <hr class="my-4" />

                <div class="col-lg-12">
                  <div class="form-group">
                    <label class="form-control-label" for="input-last-name"
                      >DOORS STYLE</label
                    >
                    <input
                      *ngIf="doorsStyleValueIsOther"
                      type="text"
                      id="input-last-name"
                      placeholder="Enter specific doors style"
                      class="form-control form-control-alternative"
                      formControlName="doorsStyle"
                    />

                    <select
                      *ngIf="!doorsStyleValueIsOther"
                      (change)="checkDoorsStyleValueIsOther()"
                      class="form-control form-control-alternative"
                      formControlName="doorsStyle"
                    >
                      <option value=""></option>
                      <option
                        *ngFor="let doorsStyleValue of doorsStyleValues"
                        [ngValue]="doorsStyleValue"
                      >
                        {{ doorsStyleValue }}
                      </option>
                    </select>
                  </div>
                </div>
              </div>

            </div>
            <div *ngIf="idOrder">
              <hr class="my-4" />
              <!-- Address -->
              <h6 class="heading-small text mb-4">
                <button
                  *ngIf="!isVisibleCantinaDoors && !isReadonly"
                  (click)="showHideFormCantina()"
                  class="btn btn-warning"
                >
                  <i class="ni ni-bold-down"></i> CANTINA DOORS - Click to Show
                </button>

                <button
                  *ngIf="isVisibleCantinaDoors && !isReadonly"
                  (click)="showHideFormCantina()"
                  class="btn btn-warning"
                >
                  <i class="ni ni-bold-up"></i> CANTINA DOORS - Click to Hide
                </button>
              </h6>
              <div
                [@fadeAnimation]="isVisibleCantinaDoors ? 'in' : 'out'"
                *ngIf="isVisibleCantinaDoors"
                formArrayName="cantinaDoors"
                class="pl-4"
              >
                <div class="row">
                  <div
                    *ngFor="
                      let cantinaDoorsForm of orderForm?.get('cantinaDoors')
                        .controls;
                      let i = index
                    "
                    class="col-md-6 mb-3"
                  >
                    <div [formGroup]="cantinaDoorsForm" class="border rounded p-3 h-100">
                      <h6 class="text-muted mb-3">Cantina Door {{i + 1}}</h6>

                      <div class="form-group">
                        <label class="form-control-label">TYPE</label>
                        <input
                          type="text"
                          class="form-control form-control-alternative"
                          formControlName="name"
                          readonly
                        />
                      </div>

                      <div class="row">
                        <div class="col-4">
                          <div class="form-group">
                            <label class="form-control-label">SWING</label>
                            <select
                              class="form-control form-control-alternative"
                              formControlName="swing"
                            >
                              <option value=""></option>
                              <option value="RH">RH</option>
                              <option value="LH">LH</option>
                            </select>
                          </div>
                        </div>
                        <div class="col-4">
                          <div class="form-group">
                            <label class="form-control-label">JAMB</label>
                            <select
                              class="form-control form-control-alternative"
                              formControlName="jamb"
                            >
                              <option value=""></option>
                              <option value="475">475</option>
                              <option value="675">675</option>
                            </select>
                          </div>
                        </div>
                        <div class="col-4">
                          <div class="form-group">
                            <label class="form-control-label">QTY</label>
                            <app-number-input formControlName="qty" [min]="0" [max]="5" [readonly]="isReadonly"></app-number-input>
                          </div>
                        </div>
                      </div>
                    </div>
                  </div>
                </div>
              </div>

              <hr class="my-4" />
              <!-- Address -->
              <h6 class="heading-small text mb-4">
                <button
                  *ngIf="!isVisibleFrenchDoors && !isReadonly"
                  (click)="showHideFormFrench()"
                  class="btn btn-warning"
                >
                  <i class="ni ni-bold-down"></i> FRENCH DOORS - Click to Show
                </button>

                <button
                  *ngIf="isVisibleFrenchDoors && !isReadonly"
                  (click)="showHideFormFrench()"
                  class="btn btn-warning"
                >
                  <i class="ni ni-bold-up"></i> FRENCH DOORS - Click to Hide
                </button>
              </h6>

              <div
                [@fadeAnimation]="isVisibleFrenchDoors ? 'in' : 'out'"
                *ngIf="isVisibleFrenchDoors"
                formArrayName="frenchDoors"
                class="pl-4"
              >
                <div class="row">
                  <div
                    *ngFor="
                      let frenchDoorsForm of orderForm?.get('frenchDoors')
                        .controls;
                      let i = index
                    "
                    class="col-md-6 mb-3"
                  >
                    <div [formGroup]="frenchDoorsForm" class="border rounded p-3 h-100">
                      <h6 class="text-muted mb-3">French Door {{i + 1}}</h6>

                      <div class="row">
                        <div class="col-6">
                          <div class="form-group">
                            <label class="form-control-label">SIZE</label>
                            <select
                              class="form-control form-control-alternative"
                              formControlName="size"
                            >
                              <option value=""></option>
                              <option value="18">18"</option>
                              <option value="24">24"</option>
                              <option value="26">26"</option>
                              <option value="28">28"</option>
                              <option value="30">30"</option>
                              <option value="32">32"</option>
                            </select>
                          </div>
                        </div>
                        <div class="col-6">
                          <div class="form-group">
                            <label class="form-control-label">SWING</label>
                            <select
                              class="form-control form-control-alternative"
                              formControlName="swing"
                            >
                              <option value=""></option>
                              <option value="RH">RH</option>
                              <option value="LH">LH</option>
                              <option value="DOUBLE">DOUBLE</option>
                            </select>
                          </div>
                        </div>
                      </div>

                      <div class="row">
                        <div class="col-4">
                          <div class="form-group">
                            <label class="form-control-label">HEIGHT</label>
                            <select
                              class="form-control form-control-alternative"
                              formControlName="height"
                            >
                              <option value=""></option>
                              <option value="80">80"</option>
                              <option value="84">84"</option>
                              <option value="96">96"</option>
                            </select>
                          </div>
                        </div>
                        <div class="col-4">
                          <div class="form-group">
                            <label class="form-control-label">JAMB</label>
                            <select
                              class="form-control form-control-alternative"
                              formControlName="jamb"
                            >
                              <option value=""></option>
                              <option value="475">475</option>
                              <option value="675">675</option>
                            </select>
                          </div>
                        </div>
                        <div class="col-4">
                          <div class="form-group">
                            <label class="form-control-label">QTY</label>
                            <app-number-input formControlName="qty" [min]="0" [max]="10" [readonly]="isReadonly"></app-number-input>
                          </div>
                        </div>
                      </div>
                    </div>
                  </div>
                </div>
              </div>

              <hr class="my-4" />
              <!-- Address -->
              <h6 class="heading-small text-muted mb-4">
                <button
                  *ngIf="!isVisibleDoubleDoors"
                  (click)="showHideFormDouble()"
                  class="btn btn-warning"
                >
                  <i class="ni ni-bold-down"></i> DOUBLE DOORS - Click to Show
                </button>

                <button
                  *ngIf="isVisibleDoubleDoors"
                  (click)="showHideFormDouble()"
                  class="btn btn-warning"
                >
                  <i class="ni ni-bold-up"></i> DOUBLE DOORS - Click to Hide
                </button>
              </h6>

              <div
                [@fadeAnimation]="isVisibleDoubleDoors ? 'in' : 'out'"
                *ngIf="isVisibleDoubleDoors"
                formArrayName="doubleDoors"
              >
                <div
                  *ngFor="
                    let doubleDoorsForm of orderForm?.get('doubleDoors')
                      .controls;
                    let i = index
                  "
                  class="pl-4"
                >
                  <div [formGroup]="doubleDoorsForm">
                    <div class="row">
                      <div class="col-3">
                        <div class="form-group">
                          <label class="form-control-label" for="input-city"
                            >SIZE</label
                          >

                          <select
                            class="form-control form-control-alternative"
                            formControlName="size"
                          >
                            <option value=""></option>
                            <option value="18">20"</option>
                            <option value="24">24"</option>
                            <option value="26">28"</option>
                            <option value="28">32"</option>
                            <option value="30">36"</option>
                            <option value="32">40"</option>
                            <option value="32">44"</option>
                            <option value="32">48"</option>
                            <option value="32">56"</option>
                            <option value="32">64"</option>
                            <option value="32">68"</option>
                            <option value="32">72"</option>
                          </select>
                        </div>
                      </div>
                      <div class="col-3">
                        <div class="form-group">
                          <label class="form-control-label" for="input-city"
                            >HEIGHT</label
                          >

                          <select
                            class="form-control form-control-alternative"
                            formControlName="height"
                          >
                            <option value="80">80"</option>
                            <option value="84">84"</option>
                            <option value="96">96"</option>
                          </select>
                        </div>
                      </div>
                      <div class="col-3">
                        <div class="form-group">
                          <label class="form-control-label" for="input-city"
                            >JAMB</label
                          >

                          <select
                            class="form-control form-control-alternative"
                            formControlName="jamb"
                          >
                            <option value=""></option>
                            <option value="475">475</option>
                            <option value="675">675</option>
                          </select>
                        </div>
                      </div>
                      <div class="col-6">
                        <div class="form-group">
                          <label class="form-control-label" for="input-country"
                            >QTY</label
                          >

                          <app-number-input formControlName="qty" [min]="0" [max]="10" [readonly]="isReadonly"></app-number-input>
                        </div>
                      </div>
                    </div>
                  </div>
                </div>
              </div>

              <hr class="my-4" />
              <!-- Address -->
              <h6 class="heading-small text-muted mb-4">
                <button
                  *ngIf="!isVisibleSingleDoors"
                  (click)="showHideFormSingle()"
                  class="btn btn-warning"
                >
                  <i class="ni ni-bold-down"></i> SINGLE DOORS - Click to Show
                </button>

                <button
                  *ngIf="isVisibleSingleDoors"
                  (click)="showHideFormSingle()"
                  class="btn btn-warning"
                >
                  <i class="ni ni-bold-up"></i> SINGLE DOORS - Click to Hide
                </button>
              </h6>

              <div
                [@fadeAnimation]="isVisibleSingleDoors ? 'in' : 'out'"
                *ngIf="isVisibleSingleDoors"
                formArrayName="singleDoors"
                class="pl-4"
              >
                <div class="row">
                  <div
                    *ngFor="
                      let singleDoorsForm of orderForm?.get('singleDoors')
                        .controls;
                      let i = index
                    "
                    class="col-lg-4 col-md-6 mb-3"
                  >
                    <div [formGroup]="singleDoorsForm" class="border rounded p-3 h-100">
                      <h6 class="text-muted mb-3">Single Door {{i + 1}}</h6>

                      <div class="row">
                        <div class="col-6">
                          <div class="form-group">
                            <label class="form-control-label">SIZE</label>
                            <select
                              class="form-control form-control-alternative"
                              formControlName="size"
                              (change)="updateSingleDoorSize(i)"
                            >
                              <option value='1/4 - 18"'>18"</option>
                              <option value='1/6 - 24"'>24"</option>
                              <option value='1/8 - 26"'>26"</option>
                              <option value='2/0 - 28"'>28"</option>
                              <option value='2/2 - 30"'>30"</option>
                              <option value='2/4 - 32"'>32"</option>
                              <option value='2/6 - 34"'>34"</option>
                              <option value='2/8 - 36"'>36"</option>
                            </select>
                          </div>
                        </div>
                        <div class="col-6">
                          <div class="form-group">
                            <label class="form-control-label">HEIGHT</label>
                            <select
                              class="form-control form-control-alternative"
                              formControlName="height"
                              (change)="updateSingleDoorSize(i)"
                            >
                              <option value=""></option>
                              <option value="80">80"</option>
                              <option value="84">84"</option>
                              <option value="96">96"</option>
                            </select>
                          </div>
                        </div>
                      </div>

                      <div class="row">
                        <div class="col-6">
                          <div class="form-group">
                            <label class="form-control-label">LEFT</label>
                            <app-number-input formControlName="left" [min]="0" [max]="999" [readonly]="isReadonly"></app-number-input>
                          </div>
                        </div>
                        <div class="col-6">
                          <div class="form-group">
                            <label class="form-control-label">RIGHT</label>
                            <app-number-input formControlName="right" [min]="0" [max]="999" [readonly]="isReadonly"></app-number-input>
                          </div>
                        </div>
                      </div>

                      <div class="row">
                        <div class="col-6">
                          <div class="form-group">
                            <label class="form-control-label">JAMB</label>
                            <select
                              class="form-control form-control-alternative"
                              formControlName="jamb"
                            >
                              <option value=""></option>
                              <option value="475">475</option>
                              <option value="675">675</option>
                            </select>
                          </div>
                        </div>
                        <div class="col-6">
                          <div class="form-group">
                            <label class="form-control-label">SIZE/HEIGHT</label>
                            <input
                              type="text"
                              class="form-control form-control-alternative"
                              formControlName="sizeHeight"
                              readonly
                              placeholder="Auto-filled"
                            />
                          </div>
                        </div>
                      </div>
                    </div>
                  </div>
                </div>
              </div>
            </div>

            <hr class="my-4" />
            <!-- Description -->
            <h6
              *ngIf="isCarpentryFound || idOrder"
              class="heading-small text-muted mb-4"
            >
              Extras
            </h6>
            <div *ngIf="isCarpentryFound || idOrder" class="pl-lg-4">
              <div class="form-group">
                <label>Comments</label>
                <textarea
                  rows="4"
                  class="form-control form-control-alternative"
                  formControlName="comment"
                  placeholder="Comments from work"
                ></textarea>
              </div>

              <!-- Create Takeoff Button - appears after comments -->
              <div *ngIf="!idOrder" class="form-group mt-4">
                <button
                  (click)="saveOrder()"
                  [disabled]="!orderForm.valid"
                  class="btn btn-success btn-lg"
                >
                  <i class="fas fa-plus mr-2"></i>
                  Create Takeoff
                </button>
              </div>
            </div>

            <div *ngIf="idOrder">
              <hr class="my-4" />
              <!-- Address -->
              <h6 class="heading-small text-muted mb-4">
                <button
                  *ngIf="!isVisibleArches"
                  (click)="showHideFormArches()"
                  class="btn btn-warning"
                >
                  <i class="ni ni-bold-down"></i> ARCHES - Click to Show
                </button>

                <button
                  *ngIf="isVisibleArches"
                  (click)="showHideFormArches()"
                  class="btn btn-warning"
                >
                  <i class="ni ni-bold-up"></i> ARCHES - Click to Hide
                </button>
              </h6>

              <div
                [@fadeAnimation]="isVisibleArches ? 'in' : 'out'"
                *ngIf="isVisibleArches"
                formArrayName="arches"
              >
                <div
                  *ngFor="
                    let archesForm of orderForm?.get('arches').controls;
                    let i = index
                  "
                  class="pl-4"
                >
                  <div [formGroup]="archesForm">
                    <div class="row">
                      <div class="col-2">
                        <div class="form-group">
                          <label class="form-control-label" for="input-city"
                            >SIZE</label
                          >

                          <input
                            type="text"
                            class="form-control form-control-alternative"
                            formControlName="size"
                            placeholder="000"
                            maxlength="3"
                            pattern="[0-9]{1,3}"
                          />
                        </div>
                      </div>
                      <div class="col-2">
                        <div class="form-group">
                          <label class="form-control-label" for="input-city"
                            >HEIGHT</label
                          >

                          <select
                            class="form-control form-control-alternative"
                            formControlName="height"
                          >
                            <option value=""></option>
                            <option value="80">80"</option>
                            <option value="96">96"</option>
                            <option value="custom">Custom</option>
                          </select>
<br/>
                          <input
                            *ngIf="archesForm.get('height')?.value === 'custom'"
                            type="text"
                            class="form-control form-control-alternative"
                            formControlName="heightCustom"
                            placeholder="Enter height"
                          />
                        </div>
                      </div>
                      <div class="col-2">
                        <div class="form-group">
                          <label class="form-control-label" for="input-city"
                            >JAMB</label
                          >

                          <select
                            class="form-control form-control-alternative"
                            formControlName="jamb"
                          >
                            <option value=""></option>
                            <option value="475">475</option>
                            <option value="675">675</option>
                            <option value="custom">Custom</option>
                          </select>
<br/>
                          <input
                            *ngIf="archesForm.get('jamb')?.value === 'custom'"
                            type="text"
                            class="form-control form-control-alternative"
                            formControlName="jambCustom"
                            placeholder="Enter jamb"
                          />
                        </div>
                      </div>
                      <div class="col-2">
                        <div class="form-group">
                          <label
                            class="form-control-label"
                            for="input-city"
                          ></label>
                          <input
                            type="text"
                            id="input-last-name"
                            class="form-control form-control-alternative"
                            formControlName="col3"
                          />
                        </div>
                      </div>
                      <div class="col-2">
                        <div class="form-group">
                          <label
                            class="form-control-label"
                            for="input-city"
                          ></label>
                          <input
                            type="text"
                            id="input-last-name"
                            class="form-control form-control-alternative"
                            formControlName="col4"
                          />
                        </div>
                      </div>
                      <div class="col-2">
                        <div class="form-group">
                          <label class="form-control-label" for="input-city"
                            >QTY</label
                          >

                          <app-number-input formControlName="qty" [min]="0" [max]="10" [readonly]="isReadonly"></app-number-input>
                        </div>
                      </div>
                    </div>
                  </div>
                </div>
              </div>

              <hr class="my-4" />
              <!-- Address -->
              <h6 class="heading-small text-muted mb-4">
                <button
                  *ngIf="!isVisibleTrim"
                  (click)="showHideFormTrim()"
                  class="btn btn-warning"
                >
                  <i class="ni ni-bold-down"></i> TRIM - Click to Show
                </button>

                <button
                  *ngIf="isVisibleTrim"
                  (click)="showHideFormTrim()"
                  class="btn btn-warning"
                >
                  <i class="ni ni-bold-up"></i> TRIM - Click to Hide
                </button>
              </h6>

              <div
                [@fadeAnimation]="isVisibleTrim ? 'in' : 'out'"
                *ngIf="isVisibleTrim"
                formArrayName="trim"
              >
                <div
                  *ngFor="
                    let trimForm of orderForm?.get('trim').controls;
                    let i = index
                  "
                  class="pl-4"
                >
                  <div [formGroup]="trimForm">
                    <div class="row">
                      <div class="col-4">
                        <div class="form-group">
                          <label class="form-control-label" for="input-city"
                            >ITEM</label
                          >
                          <input
                            type="text"
                            id="input-last-name"
                            class="form-control form-control-alternative"
                            formControlName="item"
                          />
                        </div>
                      </div>
                      <div class="col-4">
                        <div class="form-group">
                          <label class="form-control-label" for="input-city"
                            >DETAILS</label
                          >
                          <input
                            type="text"
                            id="input-last-name"
                            class="form-control form-control-alternative"
                            formControlName="details"
                          />
                        </div>
                      </div>
                      <div class="col-6">
                        <div class="form-group">
                          <label class="form-control-label" for="input-city"
                            >QTY</label
                          >

                          <app-number-input formControlName="qty" [min]="0" [max]="10" [readonly]="isReadonly"></app-number-input>
                        </div>
                      </div>
                    </div>
                  </div>
                </div>
              </div>

              <hr class="my-4" />
              <!-- Address -->
              <h6 class="heading-small text-muted mb-4">
                <button
                  *ngIf="!isVisibleHardware"
                  (click)="showHideFormHardware()"
                  class="btn btn-warning"
                >
                  <i class="ni ni-bold-down"></i> HARDWARE - Click to Show
                </button>

                <button
                  *ngIf="isVisibleHardware"
                  (click)="showHideFormHardware()"
                  class="btn btn-warning"
                >
                  <i class="ni ni-bold-up"></i> HARDWARE - Click to Hide
                </button>
              </h6>

              <div
                [@fadeAnimation]="isVisibleHardware ? 'in' : 'out'"
                *ngIf="isVisibleHardware"
                formArrayName="hardware"
              >
                <div
                  *ngFor="
                    let hardwareForm of orderForm?.get('hardware').controls;
                    let i = index
                  "
                  class="pl-4"
                >
                  <div [formGroup]="hardwareForm">
                    <div class="row">
                      <div class="col-4">
                        <div class="form-group">
                          <label class="form-control-label" for="input-city"
                            >ITEM</label
                          >
                          <input
                            type="text"
                            id="input-last-name"
                            class="form-control form-control-alternative"
                            formControlName="item"
                          />
                        </div>
                      </div>
                      <div class="col-4">
                        <div class="form-group">
                          <label class="form-control-label" for="input-city"
                            >TYPE</label
                          >
                          <input
                            type="text"
                            id="input-last-name"
                            class="form-control form-control-alternative"
                            formControlName="type"
                          />
                        </div>
                      </div>
                      <div class="col-6">
                        <div class="form-group">
                          <label class="form-control-label" for="input-city"
                            >QTY</label
                          >

                          <app-number-input formControlName="qty" [min]="0" [max]="10" [readonly]="isReadonly"></app-number-input>
                        </div>
                      </div>
                    </div>
                  </div>
                </div>
              </div>

              <hr class="my-4" />
              <!-- Address -->
              <h6 class="heading-small text-muted mb-4">
                <button
                  *ngIf="!isVisibleLabour"
                  (click)="showHideFormLabour()"
                  class="btn btn-warning"
                >
                  <i class="ni ni-bold-down"></i> LABOUR - Click to Show
                </button>

                <button
                  *ngIf="isVisibleLabour"
                  (click)="showHideFormLabour()"
                  class="btn btn-warning"
                >
                  <i class="ni ni-bold-up"></i> LABOUR - Click to Hide
                </button>
              </h6>

              <div
                [@fadeAnimation]="isVisibleLabour ? 'in' : 'out'"
                *ngIf="isVisibleLabour"
                formArrayName="labour"
              >
                <div
                  *ngFor="
                    let labourForm of orderForm?.get('labour').controls;
                    let i = index
                  "
                  class="pl-4"
                >
                  <div [formGroup]="labourForm">
                    <div class="row">
                      <div class="col-6">
                        <div class="form-group">
                          <label class="form-control-label" for="input-city"
                            >ITEM</label
                          >
                          <input
                            type="text"
                            id="input-last-name"
                            class="form-control form-control-alternative"
                            formControlName="item"
                          />
                        </div>
                      </div>
                      <div class="col-6">
                        <div class="form-group">
                          <label class="form-control-label" for="input-city"
                            >QTY</label
                          >

                          <app-number-input formControlName="qty" [min]="0" [max]="10" [readonly]="isReadonly"></app-number-input>
                        </div>
                      </div>
                    </div>
                  </div>
                </div>
              </div>

              <hr class="my-4" />
              <!-- Address -->
              <h6 class="heading-small text-muted mb-4">
                SHELVES - WIRE/METAL
              </h6>
              <div formArrayName="shelves">
                <div
                  *ngFor="
                    let shelvesForm of orderForm?.get('shelves').controls;
                    let i = index
                  "
                  class="pl-4"
                >
                  <div [formGroup]="shelvesForm">
                    <div class="row">
                      <div class="col-2">
                        <div class="form-group">
                          <label class="form-control-label" for="input-city"
                            >SIZE</label
                          >

                          <select
                            class="form-control form-control-alternative"
                            formControlName="size"
                          >
                            <option value=""></option>
                            <option value="18">18"</option>
                            <option value="24">24"</option>
                            <option value="26">26"</option>
                            <option value="28">28"</option>
                            <option value="30">30"</option>
                            <option value="32">32"</option>
                          </select>
                        </div>
                      </div>
                      <div class="col-2">
                        <div class="form-group">
                          <label class="form-control-label" for="input-city"
                            >4`</label
                          >
                          <input
                            type="text"
                            id="input-last-name"
                            class="form-control form-control-alternative"
                            formControlName="type4"
                          />
                        </div>
                      </div>
                      <div class="col-2">
                        <div class="form-group">
                          <label class="form-control-label" for="input-city"
                            >6`</label
                          >
                          <input
                            type="text"
                            id="input-last-name"
                            class="form-control form-control-alternative"
                            formControlName="type6"
                          />
                        </div>
                      </div>
                      <div class="col-2">
                        <div class="form-group">
                          <label class="form-control-label" for="input-city"
                            >8`</label
                          >
                          <input
                            type="text"
                            id="input-last-name"
                            class="form-control form-control-alternative"
                            formControlName="type8"
                          />
                        </div>
                      </div>
                      <div class="col-2">
                        <div class="form-group">
                          <label class="form-control-label" for="input-city"
                            >10`</label
                          >
                          <input
                            type="text"
                            id="input-last-name"
                            class="form-control form-control-alternative"
                            formControlName="type10"
                          />
                        </div>
                      </div>
                      <div class="col-2">
                        <div class="form-group">
                          <label class="form-control-label" for="input-city"
                            >12`</label
                          >
                          <input
                            type="text"
                            id="input-last-name"
                            class="form-control form-control-alternative"
                            formControlName="type12"
                          />
                        </div>
                      </div>
                      <div class="col-6">
                        <div class="form-group">
                          <label class="form-control-label" for="input-city"
                            >QTY</label
                          >

                          <app-number-input formControlName="qty" [min]="0" [max]="10" [readonly]="isReadonly"></app-number-input>
                        </div>
                      </div>
                    </div>
                  </div>
                </div>
              </div>

              <hr class="my-4" />
              <!-- Address -->
              <h6 class="heading-small text-muted mb-4">CLOSET RODS</h6>
              <div formArrayName="closetRods">
                <div
                  *ngFor="
                    let closetRodsForm of orderForm?.get('closetRods').controls;
                    let i = index
                  "
                  class="pl-4"
                >
                  <div [formGroup]="closetRodsForm">
                    <div class="row">
                      <div class="col-3">
                        <div class="form-group">
                          <label class="form-control-label" for="input-city"
                            >48</label
                          >
                          <input
                            type="text"
                            id="input-last-name"
                            class="form-control form-control-alternative"
                            formControlName="type1"
                          />
                        </div>
                      </div>
                      <div class="col-3">
                        <div class="form-group">
                          <label class="form-control-label" for="input-city"
                            >72</label
                          >
                          <input
                            type="text"
                            id="input-last-name"
                            class="form-control form-control-alternative"
                            formControlName="type2"
                          />
                        </div>
                      </div>
                      <div class="col-3">
                        <div class="form-group">
                          <label class="form-control-label" for="input-city"
                            >96</label
                          >
                          <input
                            type="text"
                            id="input-last-name"
                            class="form-control form-control-alternative"
                            formControlName="type3"
                          />
                        </div>
                      </div>
                      <div class="col-3">
                        <div class="form-group">
                          <label class="form-control-label" for="input-city"
                            >120</label
                          >
                          <input
                            type="text"
                            id="input-last-name"
                            class="form-control form-control-alternative"
                            formControlName="type4"
                          />
                        </div>
                      </div>
                    </div>
                  </div>
                </div>
              </div>

              <hr class="my-4" />
              <!-- Address -->
              <h6 class="heading-small text-muted mb-4">ROD SUPPORT</h6>
              <div formArrayName="rodSupport">
                <div
                  *ngFor="
                    let rodSupportForm of orderForm?.get('rodSupport').controls;
                    let i = index
                  "
                  class="pl-4"
                >
                  <div [formGroup]="rodSupportForm">
                    <div class="row">

                      <div class="col-6">
                        <div class="form-group">
                          <label
                            class="form-control-label"
                            for="input-city"
                          ></label>
                          <input
                            type="text"
                            id="input-last-name"
                            class="form-control form-control-alternative"
                            formControlName="desc"
                          />
                        </div>
                      </div>

                      <div class="col-6">
                        <div class="form-group">
                          <label class="form-control-label" for="input-city"
                            >QTY</label
                          >

                          <app-number-input formControlName="qty" [min]="0" [max]="10" [readonly]="isReadonly"></app-number-input>
                        </div>
                      </div>
                    </div>
                  </div>
                </div>
              </div>

              <hr class="my-4" />
              <!-- Address -->
              <h6 class="heading-small text-muted mb-4">ROUND WINDOW</h6>
              <div formArrayName="roundWindow">
                <div
                  *ngFor="
                    let roundWindowForm of orderForm?.get('roundWindow')
                      .controls;
                    let i = index
                  "
                  class="pl-4"
                >
                  <div [formGroup]="roundWindowForm">
                    <div class="row">
                      <div class="col-6">
                        <div class="form-group">
                          <label class="form-control-label" for="input-city"
                            >TYPE</label
                          >
                          <input
                            type="text"
                            id="input-last-name"
                            class="form-control form-control-alternative"
                            formControlName="type"
                          />
                        </div>
                      </div>

                      <div class="col-6">
                        <div class="form-group">
                          <label class="form-control-label" for="input-city"
                            >QTY</label
                          >

                          <app-number-input formControlName="qty" [min]="0" [max]="10" [readonly]="isReadonly"></app-number-input>
                        </div>
                      </div>
                    </div>
                  </div>
                </div>
              </div>
            </div>

            <div *ngIf="mobile" class="box-top row">
              <div>
                <span class="input-group-text"
                  ><i class="ni ni-bold-left"></i>
                  <button (click)="back()" class="btn btn-secondary">
                    Back
                  </button>
                </span>
              </div>
            </div>

            <div class="box-bottom row" *ngIf="idOrder">
              <!-- New Centralized Actions Component -->
              <app-takeoff-actions
                [currentStatus]="orderStatus"
                [isManager]="isManager"
                [userRole]="userRole"
                [takeoffId]="idOrder"
                [customerName]="orderForm.get('custumerName')?.value"
                [isFormValid]="orderForm.valid"
                [isLoading]="isAdvancingStatus"
                (onSaveProgress)="updateOrder()"
                (onCompleteMeasurement)="finalizeOrderPopUp()"
                (onApproveForShipping)="approveForShipping()"
                (onBackToMeasurement)="backToMeasurement()"
                (onMarkAsShipped)="markAsShipped()"
                (onSendToCarpenter)="sendToCarpenter()"
                (onMarkTrimmingCompleted)="markTrimmingCompleted()"
                (onMarkBackTrimCompleted)="markBackTrimCompleted()"
                (onCloseService)="closeService()"
              ></app-takeoff-actions>
            </div>
          </form>
        </div>
      </div>
    </div>
  </div>
</div>


<!-- Modal template removed - now using CompleteMeasurementModalComponent -->
